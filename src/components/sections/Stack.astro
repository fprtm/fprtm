---
import { Icon } from "astro-icon/components";
import BackgroundGradient from "../common/BackgroundGradient.astro";
import StackCard from "./stack/StackCard.astro";

type color =
  | "blue"
  | "orange"
  | "green"
  | "red"
  | "pink"
  | "purple"
  | "emerald"
  | "yellow"
  | "white";

interface Props {
  title: string;
  description: string;
  tabs: readonly { id: string; label: string }[];
  items: readonly {
    id: string;
    name: string;
    category: string;
    description: string;
    icon: string;
    color: color;
    colSpan?: number;
  }[];
}

const { title, description, tabs, items } = Astro.props;
---

<section id="stack" class="relative overflow-hidden py-24">
  <BackgroundGradient
    background={{
      from: "#0f172a",
      via: "#111827",
      to: "#1e293b",
    }}
    subtleGlow="emerald"
  />
  <div class="container mx-auto px-6">
    <div
      class="mb-12 flex flex-col items-start justify-between gap-6 md:flex-row md:items-end"
    >
      <div class="max-w-2xl">
        <h2 class="text-3xl font-semibold text-white md:text-4xl">{title}</h2>
        <p class="mt-4 text-white/70">{description}</p>
      </div>

      <!-- Filter Tabs -->
      <div
        class="flex flex-wrap gap-2 rounded-xl border border-white/10 bg-white/5 p-1 backdrop-blur-md"
      >
        {
          tabs.map((tab) => (
            <button
              data-tab={tab.id}
              class="tab-btn rounded-lg px-4 py-2 text-sm font-medium text-white/60 transition-all hover:bg-white/10 hover:text-white data-[active=true]:bg-purple-500/20 data-[active=true]:text-purple-300"
            >
              {tab.label}
            </button>
          ))
        }
      </div>
    </div>

    <!-- Grid -->
    <div
      id="stack-grid"
      class="grid grid-flow-dense grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4"
    >
      {items.map((item, index) => <StackCard item={item} index={index} />)}
    </div>
  </div>
</section>

<style>
  /* Entrance Animation */
  .stack-card {
    opacity: 0;
    transform: translateY(20px);
    animation: fadeUp 0.6s ease-out forwards;
  }

  @keyframes fadeUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>

<script>
  // Client-side Filtering Logic
  const tabs = document.querySelectorAll(".tab-btn");
  const cards = document.querySelectorAll(".stack-card");

  // Set initial active tab
  tabs[0].setAttribute("data-active", "true");

  tabs.forEach((tab) => {
    tab.addEventListener("click", () => {
      const category = tab.getAttribute("data-tab");

      // Update Active State
      tabs.forEach((t) => t.removeAttribute("data-active"));
      tab.setAttribute("data-active", "true");

      // Filter Logic
      cards.forEach((card) => {
        const cardCategory = card.getAttribute("data-category");
        if (category === "all" || cardCategory === category) {
          (card as HTMLElement).style.display = "block";

          // Re-trigger animation
          card.animate(
            [
              { opacity: 0, transform: "scale(0.95)" },
              { opacity: 1, transform: "scale(1)" },
            ],
            { duration: 400, easing: "cubic-bezier(0.4, 0, 0.2, 1)" },
          );
        } else {
          (card as HTMLElement).style.display = "none";
        }
      });
    });
  });
</script>
