---
import { Icon } from "astro-icon/components";
import BackgroundGradient from "../common/BackgroundGradient.astro";

interface Props {
  title: string;
  description: string;
  bio: string;
  learning: {
    title: string;
    description: string;
    badge: string;
  }[];
  profileImage: {
    src: string;
    alt: string;
  };
}

const { title, description, bio, learning, profileImage } = Astro.props;
---

<section
  id="about"
  class="relative flex min-h-[80vh] items-center overflow-hidden bg-(--color-midnight-slate) py-24"
>
  <div class="container mx-auto px-6">
    <div
      class="relative flex flex-col items-center justify-between gap-12 md:flex-row"
    >
      <!-- Text Content -->
      <div class="z-10 order-2 flex flex-col gap-6 md:order-1 md:w-1/3">
        <div>
          <h2
            class="text-xs font-bold tracking-[0.2em] text-(--color-text-muted) uppercase"
          >
            About Me
          </h2>
          <h1
            class="mt-2 text-5xl font-bold tracking-tight text-(--color-text-main) uppercase sm:text-6xl"
          >
            {title}
          </h1>
          <p class="mt-4 text-lg font-light text-(--color-text-muted)">
            {bio}
          </p>
        </div>

        <!-- Learning - Interactive Carousel -->
        <div class="border-l-2 border-slate-700 pl-4">
          <div id="learning-carousel" data-items={JSON.stringify(learning)}>
            <h3
              id="learning-title"
              class="text-sm font-semibold tracking-wider text-(--color-text-main) uppercase transition-opacity duration-300"
            >
              {learning[0].title}
            </h3>
            <p
              id="learning-description"
              class="mt-1 text-sm text-(--color-text-muted) transition-opacity duration-300"
            >
              {learning[0].description}
            </p>
            <div class="mt-3 flex items-center gap-2">
              <span class="relative flex h-2 w-2">
                <span
                  class="absolute inline-flex h-full w-full animate-ping rounded-full bg-(--color-cyber-teal) opacity-75"
                ></span>
                <span
                  class="relative inline-flex h-2 w-2 rounded-full bg-(--color-cyber-teal)"
                ></span>
              </span>
              <span
                id="learning-badge"
                class="font-mono text-xs text-(--color-cyber-teal) transition-opacity duration-300"
                >{learning[0].badge}</span
              >
            </div>
          </div>
        </div>
      </div>

      <!-- Center Image Composition -->
      <div
        class="relative order-1 flex w-full items-center justify-center md:order-2 md:w-2/3"
      >
        <!-- The Big White Circle -->
        <div
          class="absolute h-[300px] w-[300px] rounded-full bg-(--color-light-navy) md:h-[500px] md:w-[500px]"
        >
        </div>

        <!-- Image -->
        <div
          class="relative z-10 h-[350px] w-[300px] overflow-hidden md:h-[600px] md:w-[500px]"
        >
          <img
            src={profileImage.src}
            alt={profileImage.alt}
            class="h-full w-full object-cover object-center grayscale transition-all duration-500 hover:grayscale-0"
            style="mask-image: linear-gradient(to bottom, black 80%, transparent 100%);"
          />
        </div>

        <!-- Floating Element (Clickable Arrow) -->
        <button
          id="next-learning-btn"
          class="absolute -right-4 bottom-1/4 z-20 hidden cursor-pointer transition-transform hover:scale-110 active:scale-95 md:block"
          aria-label="Next focus"
        >
          <Icon
            name="lucide:arrow-right-circle"
            class="h-12 w-12 text-(--color-text-main) opacity-80 hover:text-(--color-cyber-teal)"
          />
        </button>
      </div>

      <!-- Right Side Navigation/Decoration -->
      <div
        class="absolute top-1/2 right-6 hidden -translate-y-1/2 flex-col gap-8 text-xs font-medium text-(--color-text-muted) md:flex"
      >
        <span
          id="nav-indicator-0"
          class="text-(--color-text-main) transition-colors duration-300"
          >01</span
        >
        <span id="nav-indicator-1" class="transition-colors duration-300"
          >02</span
        >
        <span id="nav-indicator-2" class="transition-colors duration-300"
          >03</span
        >
      </div>
    </div>
  </div>
</section>

<script>
  // Script to handle the carousel logic
  const carouselContainer = document.getElementById("learning-carousel");
  const nextBtn = document.getElementById("next-learning-btn");

  const titleEl = document.getElementById("learning-title");
  const descEl = document.getElementById("learning-description");
  const badgeEl = document.getElementById("learning-badge");

  const navIndicators = [
    document.getElementById("nav-indicator-0"),
    document.getElementById("nav-indicator-1"),
    document.getElementById("nav-indicator-2"),
  ];

  if (carouselContainer && nextBtn && titleEl && descEl && badgeEl) {
    const items = JSON.parse(carouselContainer.dataset.items || "[]");
    let currentIndex = 0;

    function updateCarousel(index: number) {
      // Fade out
      titleEl!.style.opacity = "0";
      descEl!.style.opacity = "0";
      badgeEl!.style.opacity = "0";

      setTimeout(() => {
        // Update content
        titleEl!.textContent = items[index].title;
        descEl!.textContent = items[index].description;
        badgeEl!.textContent = items[index].badge;

        // Update indicators
        navIndicators.forEach((el, i) => {
          if (el) {
            if (i === index) {
              el.classList.add("text-(--color-text-main)");
            } else {
              el.classList.remove("text-(--color-text-main)");
            }
          }
        });

        // Fade in
        titleEl!.style.opacity = "1";
        descEl!.style.opacity = "1";
        badgeEl!.style.opacity = "1";
      }, 300); // Wait for fade out
    }

    nextBtn.addEventListener("click", () => {
      currentIndex = (currentIndex + 1) % items.length;
      updateCarousel(currentIndex);
    });
  }
</script>
